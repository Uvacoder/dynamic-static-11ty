# Dynamic-Static

An static, [Eleventy](https://www.11ty.dev/) blog, with dynamic markup generated by [Cloudflare Workers](https://workers.cloudflare.com/).

## Live Demo

See it in action [here](https://dynamic-static-11ty.jkup.workers.dev/)

## How it works

This is an [Eleventy](https://www.11ty.dev/) website that is built and served by Cloudflare [Workers sites](https://developers.cloudflare.com/workers/platform/sites). Cloudflare's [wrangler cli](https://github.com/cloudflare/wrangler) takes each page in the `_site` directory and stores it in [Workers KV](https://developers.cloudflare.com/workers/learning/how-kv-works).

When a user requests the site, the Worker takes the HTML page from KV and before serving it runs it through [HTMLRewriter](https://developers.cloudflare.com/workers/runtime-apis/html-rewriter). This means that Workers can get dynamic data at runtime and edit the HTML before serving it to the client.

## Run this yourself

1. Clone the repo

```sh
git clone git@github.com:jkup/dynamic-static-11ty.git
```

2. npm install

```sh
npm install
```

3. npx eleventy to generate the static site

```sh
npx @11ty/eleventy
```

4. Set your Worker name in `wrangler.toml`. It's currently "dynamic-static-11ty" but you can make it anything you want.
5. Sign up for a Workers account and install the CLI. Instructions can be found [here](https://developers.cloudflare.com/workers/get-started/guide)
6. Wrangler login

```sh
wrangler login
```

7. Publish your Worker!

```sh
wrangler publish
```

## How to do this yourself

1. Create an empty GitHub repo
2. Clone the [11ty starter blog](https://github.com/11ty/eleventy-base-blog) into a new folder

```sh
git clone https://github.com/11ty/eleventy-base-blog.git your-repo-name
```

3. Override the base blog origin to your new repo

```sh
git remote set-url origin git@github.com:your/repo.git
```

4. Initialize a [Wokers Sites](https://developers.cloudflare.com/workers/platform/sites) project in this repo

```sh
wrangler init --site your-repo-name
```

5. Open `workers-site/index.js`
6. Add any [KV Store](https://developers.cloudflare.com/workers/learning/how-kv-works) or [HTMLRewriter](https://developers.cloudflare.com/workers/runtime-apis/html-rewriter) code you want before it sets headers and returns a response.
7. Publish to Workers!

```sh
wrangler publish
```

Note: You'll have to run `npx eleventy` before `wrangler publish` because wrangler will just grab whatever is currently in `_site/`.
